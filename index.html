<script>
// ç¦ç”¨å³éµ
document.addEventListener('contextmenu', e => e.preventDefault());

// ç¦ç”¨ F12ã€Ctrl+Shift+Iã€Ctrl+U
document.addEventListener('keydown', e => {
  if (
    e.key === 'F12' ||
    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
    (e.ctrlKey && e.key === 'U')
  ) {
    e.preventDefault();
  }
});
</script>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Auristar éŠæˆ²å•†åŸ - å®Œæ•´ç‰ˆ</title>
<style>
  body {
    font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    background: #f5f5f7;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: #fff;
    padding: 20px 30px;
    border-radius: 6px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
  }
  h1 {
    color: #e67e22;
    text-align: center;
    margin-bottom: 24px;
  }
  label {
    display: block;
    margin: 14px 0 6px;
    font-weight: bold;
    color: #333;
  }
  select,
  input[type="number"] {
    width: 100%;
    padding: 9px 12px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button {
    background: #e67e22;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 22px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 12px;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background: #cf6c19;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  .hidden {
    display: none !important;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  th,
  td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }
  th {
    background: #f0f0f0;
  }
  #paymentInfo {
    margin-top: 15px;
    padding: 14px;
    background: #e8f0fe;
    border-radius: 5px;
    color: #0056b3;
    font-weight: 600;
  }
</style>
</head>
<body>
<canvas id="starfield" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;"></canvas>
<script>
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
let stars = [];
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
for (let i = 0; i < 120; i++) {
  stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, r: Math.random() * 1.5 });
}
function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#fff";
  for (let s of stars) {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fill();
    s.y += 0.2;
    if (s.y > canvas.height) s.y = 0;
  }
  requestAnimationFrame(drawStars);
}
drawStars();
</script>
  <div class="container">
    <h1>ğŸŒŸ Auristar éŠæˆ²å•†åŸ ç·šä¸Šè¨‚è³¼å°ˆå€</h1>

    <!-- ç¬¬1æ­¥ é¡åˆ¥é¸æ“‡ -->
    <label>1ï¸âƒ£ é¸æ“‡é¡åˆ¥</label>
    <select id="category">
      <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
      <option value="roblox">Roblox</option>
      <option value="discord">Discord</option>
      <option value="social">ç¤¾ç¾¤æµé‡æœå‹™</option>
    </select>

    <!-- ç¬¬2æ­¥ å•†å“é¡åˆ¥ -->
    <div id="step2" class="hidden">
      <label>2ï¸âƒ£ é¸æ“‡å•†å“é¡åˆ¥</label>
      <select id="subcategory"></select>
    </div>

    <!-- ç¬¬3æ­¥ ç¬¬3å±¤é¸é … -->
    <div id="step3" class="hidden">
      <label>3ï¸âƒ£ é¸æ“‡ç´°åˆ†é¡</label>
      <select id="tier3"></select>
    </div>

    <!-- ç¬¬4æ­¥ ç¬¬4å±¤å•†å“æˆ–è‡ªè¨‚é‡‘é¡ -->
    <div id="step4" class="hidden">
      <label id="step4Label">4ï¸âƒ£ é¸æ“‡å•†å“</label>
      <select id="tier4" class="hidden"></select>
      <div id="customAmountDiv" class="hidden">
        <input type="number" id="customAmount" min="1" placeholder="è«‹è¼¸å…¥è‡ªè¨‚é‡‘é¡" />
        <p>å¯¦ä»˜é‡‘é¡ï¼šNT$<span id="customPrice">0</span></p>
      </div>
    </div>

    <!-- åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ• -->
    <button id="addToCart" disabled>åŠ å…¥è³¼ç‰©è»Š</button>

    <!-- è³¼ç‰©è»Šå€åŸŸ -->
    <div id="cartSection" class="hidden">
      <h2>ğŸ›’ è³¼ç‰©è»Š</h2>
      <table>
        <thead>
          <tr>
            <th>å•†å“åç¨±</th>
            <th>åƒ¹æ ¼</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="cartBody"></tbody>
        <tfoot>
          <tr>
            <th>ç¸½è¨ˆ</th>
            <th id="totalPrice">NT$0</th>
            <th></th>
          </tr>
        </tfoot>
      </table>
      <button id="checkoutBtn">çµå¸³</button>
    </div>

    <!-- çµå¸³å€åŸŸ -->
    <div id="checkoutSection" class="hidden">
      <h2>ğŸ’³ é¸æ“‡ä»˜æ¬¾æ–¹å¼</h2>
      <select id="paymentMethod">
        <option value="">è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
        <option value="8591">8591</option>
        <option value="convenience">è¶…å•†ä»£ç¢¼</option>
        <option value="chinatrust">ä¸­ä¿¡ç„¡å¡</option>
      </select>
      <div id="paymentInfo"></div>
<div style="margin-top: 15px;">
  <label>ğŸ‘¤ é¡§å®¢å§“åï¼š</label>
  <input type="text" id="customerName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required>
  <label>ğŸ“§ é›»å­éƒµä»¶ï¼š</label>
  <input type="email" id="customerEmail" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email" required>
  <div style="margin-top: 10px;">
    <input type="checkbox" id="agreeTerms" />
    æˆ‘å·²é–±è®€ä¸¦åŒæ„ <a href="#" target="_blank">æœå‹™æ¢æ¬¾</a>
  </div>
</div>

      <button id="sendOrder" disabled>é€å‡ºè¨‚å–®</button>
    </div>
  </div>

<script>
(() => {
  const webhookURL = "https://fancy-wind-f755.jzuo05054.workers.dev/";

  // å•†å“è³‡æ–™çµæ§‹
  const products = {
    roblox: {
      subcats: ["å¸³è™Ÿ", "ä»£å„²", "ä»£è³¼"],
      items: {
        "å¸³è™Ÿ": [
          { name: "bloxfruitéš¨æ©Ÿ 2~8 ç´…æœåº«å­˜", price: 120 },
          { name: "Lv2000+ å«ç¥äººæ‹³", price: 80 },
          { name: "éš¨æ©Ÿ V4 æ»¿é½’", price: 270 },
          { name: "éš¨æ©Ÿ V4 æ»¿é½’ + é›™åˆ€ + ç¥äººæ‹³ + éˆé­‚å‰ä»–", price: 300 },
          { name: "Lv2500+ é›™åˆ€ + ç¥äººæ‹³ + éˆé­‚å‰ä»–", price: 200 },
          { name: "é¾æ— V4 æ»¿é½’ + é›™åˆ€ + ç¥äººæ‹³ + éˆé­‚å‰ä»–", price: 1300 },
          { name: "å…”å­ V4 æ»¿é½’ + é›™åˆ€ + ç¥äººæ‹³ + éˆé­‚å‰ä»–", price: 400 },
          { name: "é¯Šé­š V4 æ»¿é½’ + é›™åˆ€ + ç¥äººæ‹³ + éˆé­‚å‰ä»–", price: 400 },
          { name: "äººé¡ V4 æ»¿é½’ + é›™åˆ€ + ç¥äººæ‹³ +éˆé­‚å‰ä»–", price: 400 },
          { name: "å¤©ä½¿ V4 æ»¿é½’ + é›™åˆ€ +ç¥äººæ‹³ +éˆé­‚å‰ä»–", price: 400 },
          { name: "å¸è¡€é¬¼ V4 æ»¿é½’ + é›™åˆ€ +ç¥äººæ‹³ +éˆé­‚å‰ä»–", price: 500 },
          { name: "æ©Ÿå™¨äºº V4 æ»¿é½’ + é›™åˆ€ +ç¥äººæ‹³ +éˆé­‚å‰ä»–", price: 500 }
        ],
        "ä»£å„²": [
          { name: "400 Robux", price: 160 },
          { name: "800 Robux", price: 300 },
          { name: "1700 Robux", price: 600 },
          { name: "2500 Robux", price: 900 },
          { name: "4500 Robux", price: 1450 },
          { name: "10000 Robux", price: 2800 },
          { name: "22500 Robux", price: 5600 }
        ],
        "ä»£è³¼": {
          subsubs: ["bloxfruit", "Rivals ç«¶çˆ­è€…", "Grow a Garden", "éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰"],
          bloxfruit: [
            { name: "ç«ç„°", price: 120 },
            { name: "çµé·¹", price: 210 },
            { name: "å†°å‡", price: 150 },
            { name: "æ²™å­", price: 170 },
            { name: "é»‘æš—", price: 190 },
            { name: "é‘½çŸ³", price: 210 },
            { name: "é–ƒé–ƒ", price: 240 },
            { name: "æ©¡è† ", price: 250 },
            { name: "å‰µé€ ", price: 340 },
            { name: "å¾©æ´»", price: 270 },
            { name: "å²©æ¼¿", price: 280 },
            { name: "åœ°éœ‡", price: 300 },
            { name: "äººä½›", price: 320 },
            { name: "æ„›æƒ…", price: 330 },
            { name: "ç·šç·š", price: 340 },
            { name: "è²éŸ³", price: 360 },
            { name: "é–€é–€", price: 380 },
            { name: "é³³å‡°", price: 380 },
            { name: "éŸ¿é›·", price: 400 },
            { name: "çˆªå­", price: 410 },
            { name: "é›ªé›ª", price: 420 },
            { name: "é‡åŠ›", price: 440 },
            { name: "çŒ›ç‘ª", price: 440 },
            { name: "æš´é¾", price: 440 },
            { name: "éºµç³°", price: 450 },
            { name: "å½±å­", price: 460 },
            { name: "æ¯’æ¶²", price: 470 },
            { name: "æ§åˆ¶", price: 480 },
            { name: "ç“¦æ–¯", price: 490 },
            { name: "éˆé­‚", price: 500 },
            { name: "çµè±¹", price: 600 },
            { name: "é›ªæ€ª", price: 600 },
            { name: "ä¹å°¾", price: 800 },
            { name: "é¾é¾", price: 1000 },
            // é€šè¡Œè­‰
            { name: "é›™å€æ‰è½ç‰©", price: 90 },
            { name: "å¿«èˆ¹", price: 90 },
            { name: "é›™å€é‡‘éŒ¢", price: 110 },
            { name: "é›™å€ç²¾é€š", price: 110 },
            { name: "é»‘åˆ€", price: 250 },
            { name: "æœæ¢", price: 550 },
            // æœå€‰
            { name: "æœå€‰ x1", price: 100 },
            { name: "æœå€‰ x3", price: 270 },
            { name: "æœå€‰ x5", price: 430 },
            { name: "æœå€‰ x10", price: 850 }
          ],
          "Rivals ç«¶çˆ­è€…": [
            { name: "çš®è†šç®± Skin Case 1 x1", price: 70 },
            { name: "çš®è†šç®± Skin Case 2 x1", price: 70 },
            { name: "çš®è†šç®± Skin Case 3 x1", price: 70 },
            // é€šè¡Œè­‰çµ„åˆåŒ…
            { name: "RPG çµ„åˆåŒ…", price: 60 },
            { name: "èƒ½æºçµ„åˆåŒ… (1299R)", price: 280 },
            { name: "å¤–æ˜Ÿçµ„åˆåŒ… (649R)", price: 160 },
            { name: "é†«ç™‚çµ„åˆåŒ… (249R)", price: 80 },
            { name: "é‡å‹çµ„åˆåŒ… (1899R)", price: 410 },
            { name: "ç¶“å…¸çµ„åˆåŒ… (1149R)", price: 260 },
            { name: "æ™®é€šæ­¦å™¨çµ„åˆåŒ… (999R)", price: 220 },
            { name: "åƒç´ çµ„åˆåŒ… (888R)", price: 200 },
            { name: "åˆå­¸è€…çµ„åˆåŒ… (49R)", price: 40 },
            { name: "è¶…ç´šé‘°åŒ™çµ„åˆåŒ… (2199R)", price: 500 },
            { name: "å‚³å¥‡é‘°åŒ™çµ„åˆåŒ… (4999R)", price: 1000 }
          ],
          "Grow a Garden": [
            { name: "èœ»èœ“", price: 150 },
            { name: "èœ‚å¥³ç‹", price: 150 },
            { name: "è´è¶", price: 200 },
            { name: "æµ£ç†Š", price: 200 },
            { name: "è¿ªæ–¯å¯èœœèœ‚", price: 200 },
            { name: "ç« é­š", price: 150 },
            { name: "EXOTIC SUMMER SEED PACK*3", price: 150 },
            { name: "EXOTIC SUMMER SEED PACK*10", price: 350 },
            { name: "PREMIUM OAISIS EGG*3", price: 100 },
            { name: "PREMIUM OAISIS EGG*10", price: 280 }
          ]
        },
        "éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰": "custom"
      },
    },
    discord: {
      subcats: ["ğ–­ğ—‚ğ—ğ—‹ğ—ˆ ä»£è³¼", "ä¼ºæœå™¨åŠ æˆ"],
      items: {
        "ğ–­ğ—‚ğ—ğ—‹ğ—ˆ ä»£è³¼": [
          { name: "Discord Nitro 1å€‹æœˆ", price: 230 },
          { name: "Discord Nitro 1å¹´", price: 2500 }
        ],
        "ä¼ºæœå™¨åŠ æˆ": [
          { name: "ä¼ºæœå™¨å¢å¼· 1å€‹æœˆ 14æ¬¡åŠ æˆ", price: 250 }
        ]
      }
    },
    social: {
      subcats: ["YouTube", "TikTok", "Instagram", "Facebook"],
      items: {
        "YouTube": [
          { name: "YouTube é »é“è¨‚é–± 1000", price: 400 },
          { name: "YouTube è§€çœ‹æ¬¡æ•¸ 10000", price: 350 }
        ],
        "TikTok": [
          { name: "TikTok ç²‰çµ² 1000", price: 400 },
          { name: "TikTok è§€çœ‹ 10000", price: 350 }
        ],
        "Instagram": [
          { name: "Instagram ç²‰çµ² 1000", price: 400 },
          { name: "Instagram äº’å‹• 1000", price: 350 }
        ],
        "Facebook": [
          { name: "Facebook ç²‰çµ² 1000", price: 400 },
          { name: "Facebook äº’å‹• 1000", price: 350 }
        ]
      }
    }
  };

  // DOM ç‰©ä»¶
  const categorySel = document.getElementById("category");
  const subcategorySel = document.getElementById("subcategory");
  const step2Div = document.getElementById("step2");

  const step3Div = document.getElementById("step3");
  const tier3Sel = document.getElementById("tier3");

  const step4Div = document.getElementById("step4");
  const tier4Sel = document.getElementById("tier4");
  const customAmountDiv = document.getElementById("customAmountDiv");
  const customAmountInput = document.getElementById("customAmount");
  const customPriceSpan = document.getElementById("customPrice");
  const step4Label = document.getElementById("step4Label");

  const addToCartBtn = document.getElementById("addToCart");
  const cartSection = document.getElementById("cartSection");
  const cartBody = document.getElementById("cartBody");
  const totalPriceTh = document.getElementById("totalPrice");
  const checkoutBtn = document.getElementById("checkoutBtn");

  const checkoutSection = document.getElementById("checkoutSection");
  const paymentMethodSel = document.getElementById("paymentMethod");
  const paymentInfoDiv = document.getElementById("paymentInfo");
  const sendOrderBtn = document.getElementById("sendOrder");

  // ç‹€æ…‹
  let selectedCategory = "";
  let selectedSubcategory = "";
  let selectedTier3 = "";
  let selectedTier4 = "";
  let customAmount = 0;

  let cart = [];

  // éš¨æ©Ÿè¨‚å–®ä»£ç¢¼ç”¢ç”Ÿå™¨
  function generateOrderCode(length = 10) {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let code = "";
    for (let i = 0; i < length; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
  }

  // åˆå§‹åŒ–å­åˆ†é¡
  function updateSubcategories() {
    selectedCategory = categorySel.value;
    clearStep(2);
    clearStep(3);
    clearStep(4);
    addToCartBtn.disabled = true;

    if (!selectedCategory) {
      step2Div.classList.add("hidden");
      step3Div.classList.add("hidden");
      step4Div.classList.add("hidden");
      return;
    }
    step2Div.classList.remove("hidden");
    // å¡«å…¥å­åˆ†é¡
    subcategorySel.innerHTML = '<option value="">è«‹é¸æ“‡å•†å“é¡åˆ¥</option>';
    const subs = products[selectedCategory].subcats;
    subs.forEach(s => {
      subcategorySel.insertAdjacentHTML("beforeend", `<option value="${s}">${s}</option>`);
    });
  }

  // ç¬¬3æ­¥åˆ¤æ–·èˆ‡æ›´æ–°
  function updateTier3() {
    selectedSubcategory = subcategorySel.value;
    clearStep(3);
    clearStep(4);
    addToCartBtn.disabled = true;

    if (!selectedSubcategory) {
      step3Div.classList.add("hidden");
      step4Div.classList.add("hidden");
      return;
    }

    // ç‰¹æ®Šåˆ¤æ–·ï¼šRobloxä»£è³¼éœ€è¦å¤šå±¤æ¬¡é¸æ“‡
    if (selectedCategory === "roblox" && selectedSubcategory === "ä»£è³¼") {
      step3Div.classList.remove("hidden");
      tier3Sel.innerHTML = '<option value="">è«‹é¸æ“‡ä»£è³¼åˆ†é¡</option>';
      const subsubs = products.roblox.items["ä»£è³¼"].subsubs;
      subsubs.forEach(s => {
        tier3Sel.insertAdjacentHTML("beforeend", `<option value="${s}">${s}</option>`);
      });
    } else {
      // æ™®é€šå•†å“ï¼Œç›´æ¥ç¬¬4æ­¥å‡ºç¾å•†å“æ¸…å–®
      step3Div.classList.add("hidden");
      updateTier4();
    }
  }

  // ç¬¬4æ­¥åˆ¤æ–·èˆ‡æ›´æ–°
  function updateTier4() {
    if (step3Div.classList.contains("hidden")) {
      // æ²’ç¬¬3æ­¥ï¼Œç›´æ¥ç¬¬4æ­¥æ ¹æ“šsubcaté¡¯ç¤ºå•†å“
      selectedTier3 = "";
      selectedTier4 = "";
      clearStep(4);
      addToCartBtn.disabled = true;
      if (!selectedSubcategory) {
        step4Div.classList.add("hidden");
        return;
      }
      step4Div.classList.remove("hidden");
      tier4Sel.classList.remove("hidden");
      customAmountDiv.classList.add("hidden");
      step4Label.textContent = "3ï¸âƒ£ é¸æ“‡å•†å“";

      const items = products[selectedCategory].items[selectedSubcategory];
      if (!items) {
        step4Div.classList.add("hidden");
        return;
      }
      // å¡«å•†å“
      tier4Sel.innerHTML = '<option value="">è«‹é¸æ“‡å•†å“</option>';
      items.forEach((item, i) => {
        tier4Sel.insertAdjacentHTML("beforeend", `<option value="${i}">${item.name} â†’ NT$${item.price}</option>`);
      });
      return;
    }

    // ç¬¬3æ­¥å­˜åœ¨ï¼Œä¾ç…§ç¬¬3æ­¥é¸é …é¡¯ç¤º
    selectedTier3 = tier3Sel.value;
    clearStep(4);
    addToCartBtn.disabled = true;
    if (!selectedTier3) {
      step4Div.classList.add("hidden");
      return;
    }
    step4Div.classList.remove("hidden");

    if (selectedTier3 === "éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰") {
      // é¡¯ç¤ºè‡ªè¨‚é‡‘é¡è¼¸å…¥æ¡†
      tier4Sel.classList.add("hidden");
      customAmountDiv.classList.remove("hidden");
      step4Label.textContent = "4ï¸âƒ£ è«‹è¼¸å…¥è‡ªè¨‚é‡‘é¡";
      customAmountInput.value = "";
      customPriceSpan.textContent = "0";
      customAmount = 0;
      addToCartBtn.disabled = true;
      return;
    }

    // éè‡ªè¨‚é‡‘é¡ï¼Œé¡¯ç¤ºå°æ‡‰å•†å“æ¸…å–®
    tier4Sel.classList.remove("hidden");
    customAmountDiv.classList.add("hidden");
    step4Label.textContent = "4ï¸âƒ£ é¸æ“‡å•†å“";

    const items = products.roblox.items["ä»£è³¼"][selectedTier3];
    if (!items) {
      step4Div.classList.add("hidden");
      return;
    }
    tier4Sel.innerHTML = '<option value="">è«‹é¸æ“‡å•†å“</option>';
    items.forEach((item, i) => {
      tier4Sel.insertAdjacentHTML("beforeend", `<option value="${i}">${item.name} â†’ NT$${item.price}</option>`);
    });
  }

  // æ¸…ç†æŸæ­¥é©Ÿå…§å®¹
  function clearStep(stepNum) {
    if (stepNum <= 2) {
      subcategorySel.value = "";
      step2Div.classList.add("hidden");
    }
    if (stepNum <= 3) {
      tier3Sel.innerHTML = "";
      tier3Sel.value = "";
      step3Div.classList.add("hidden");
    }
    if (stepNum <= 4) {
      tier4Sel.innerHTML = "";
      tier4Sel.value = "";
      step4Div.classList.add("hidden");
      customAmountDiv.classList.add("hidden");
      customAmountInput.value = "";
      customPriceSpan.textContent = "0";
    }
  }

  // æ›´æ–°åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ•ç‹€æ…‹
  function updateAddToCartStatus() {
    let enable = false;
    if (step4Div.classList.contains("hidden")) {
      enable = false;
    } else {
      if (selectedTier3 === "éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰") {
        enable = customAmount > 0;
      } else if (step3Div.classList.contains("hidden")) {
        enable = tier4Sel.value !== "";
      } else {
        enable = tier4Sel.value !== "";
      }
    }
    addToCartBtn.disabled = !enable;
  }

  // åŠ å…¥è³¼ç‰©è»Š
  function addToCart() {
    let itemName = "";
    let itemPrice = 0;

    if (selectedCategory === "" || selectedSubcategory === "") return;

    if (!step3Div.classList.contains("hidden")) {
      if (selectedTier3 === "éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰") {
        if (customAmount <= 0) return;
        itemName = `ROBLOX éŠæˆ²è´ˆç¦®æœå‹™ï¼ˆè‡ªè¨‚é‡‘é¡ï¼‰ R:${customAmount}`;
        itemPrice = Math.round(customAmount * 0.18);
      } else {
        if (tier4Sel.value === "") return;
        const item = products.roblox.items["ä»£è³¼"][selectedTier3][parseInt(tier4Sel.value)];
        itemName = item.name;
        itemPrice = item.price;
      }
    } else {
      if (tier4Sel.value === "") return;
      const item = products[selectedCategory].items[selectedSubcategory][parseInt(tier4Sel.value)];
      itemName = item.name;
      itemPrice = item.price;
    }

    cart.push({ name: itemName, price: itemPrice });
    alert(`å·²åŠ å…¥è³¼ç‰©è»Š: ${itemName}ï¼Œåƒ¹æ ¼ NT$${itemPrice}`);
    renderCart();

    // é‡ç½®é¸æ“‡
    clearStep(3);
    clearStep(4);
    addToCartBtn.disabled = true;
  }

  // é¡¯ç¤ºè³¼ç‰©è»Šå…§å®¹
  function renderCart() {
    if (cart.length === 0) {
      cartSection.classList.add("hidden");
      checkoutSection.classList.add("hidden");
      return;
    }
    cartSection.classList.remove("hidden");
    checkoutSection.classList.add("hidden");
    cartBody.innerHTML = "";
    let total = 0;
    cart.forEach((item, idx) => {
      total += item.price;
      cartBody.insertAdjacentHTML(
        "beforeend",
        `<tr>
          <td>${item.name}</td>
          <td>NT$${item.price}</td>
          <td><button data-idx="${idx}" class="removeBtn">åˆªé™¤</button></td>
        </tr>`
      );
    });
    totalPriceTh.textContent = `NT$${total}`;
  }

  // åˆªé™¤è³¼ç‰©è»Šå•†å“
  cartBody.addEventListener("click", (e) => {
    if (e.target.classList.contains("removeBtn")) {
      const idx = parseInt(e.target.getAttribute("data-idx"));
      if (!isNaN(idx)) {
        cart.splice(idx, 1);
        renderCart();
      }
    }
  });

  // é»çµå¸³é¡¯ç¤ºä»˜æ¬¾é¸é …
  checkoutBtn.addEventListener("click", () => {
    if (cart.length === 0) {
      alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼");
      return;
    }
    checkoutSection.classList.remove("hidden");
    cartSection.classList.add("hidden");
    paymentMethodSel.value = "";
    paymentInfoDiv.textContent = "";
    sendOrderBtn.disabled = true;
  });

  // ä»˜æ¬¾æ–¹å¼é¸æ“‡æ”¹è®Š
  paymentMethodSel.addEventListener("change", () => {
    const val = paymentMethodSel.value;
    sendOrderBtn.disabled = val === "";
    paymentInfoDiv.innerHTML = "";

    if (val === "8591" || val === "convenience") {
      const orderCode = generateOrderCode();
      paymentInfoDiv.innerHTML = `
        <p>è«‹è‡³æ­¤ <a href="https://discord.gg/jt4ZvhnCDQ" target="_blank">Discord ç¾¤çµ„</a> æˆ–æ‰¾é‡‘ä½é™³ (FB) ä¸‹å–®ï¼Œé™„ä¸Šè¨‚å–®ä»£ç¢¼å³å¯(ç›¡é‡æ–¼ Discord ä¸‹å–®)</p>
        <p>FB: <a href="https://www.facebook.com/jin.zuo.chen.2025" target="_blank">https://www.facebook.com/jin.zuo.chen.2025</a></p>
        <p>Discord: <a href="https://discord.gg/jt4ZvhnCDQ" target="_blank">https://discord.gg/jt4ZvhnCDQ</a></p>
        <p><strong>è¨‚å–®ä»£ç¢¼ï¼š${orderCode}</strong></p>
      `;
      sendOrderBtn.dataset.orderCode = orderCode;
    } else if (val === "chinatrust") {
      const orderCode = generateOrderCode();
      paymentInfoDiv.innerHTML = `
        <p>å¸³è™Ÿï¼š<strong>325540828773</strong></p>
        <p>ç¹³è²»å®Œæˆè«‹åˆ° FB æˆ– Discord å–è²¨ä¸¦é™„ä¸Šè¨‚å–®è™Ÿç¢¼å’Œç™¼ç¥¨è­‰æ˜ï¼š</p>
        <p>FB: <a href="https://www.facebook.com/jin.zuo.chen.2025" target="_blank">https://www.facebook.com/jin.zuo.chen.2025</a></p>
        <p>Discord: <a href="https://discord.gg/jt4ZvhnCDQ" target="_blank">https://discord.gg/jt4ZvhnCDQ</a></p>
        <p><strong>è¨‚å–®ä»£ç¢¼ï¼š${orderCode}</strong></p>
      `;
      sendOrderBtn.dataset.orderCode = orderCode;
    } else {
      sendOrderBtn.dataset.orderCode = "";
    }
  });

  // é€å‡ºè¨‚å–®ä¸¦ç”¨Discord Webhooké€šçŸ¥
  sendOrderBtn.addEventListener("click", () => {
    const orderCode = sendOrderBtn.dataset.orderCode || generateOrderCode();
    const paymentMethod = paymentMethodSel.value;

    if (cart.length === 0) {
      alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼");
      return;
    }
    if (!paymentMethod) {
      alert("è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼");
      return;
    }

    let total = 0;
    let orderDesc = "";
    cart.forEach((item, idx) => {
      orderDesc += `${idx + 1}. ${item.name} - NT$${item.price}\n`;
      total += item.price;
    });
    orderDesc += `\nç¸½åƒ¹: NT$${total}\nä»˜æ¬¾æ–¹å¼: ${paymentMethod}\nè¨‚å–®ä»£ç¢¼: ${orderCode}`;

    // ç™¼é€Webhook (åªæ”¯æŒfetchçš„ç’°å¢ƒ)
    
const name = document.getElementById("customerName").value.trim();
const email = document.getElementById("customerEmail").value.trim();
const agreed = document.getElementById("agreeTerms").checked;
if (!name || !email) {
  alert("è«‹è¼¸å…¥å§“åèˆ‡é›»å­éƒµä»¶ï¼");
  return;
}
if (!agreed) {
  alert("è«‹å‹¾é¸åŒæ„æœå‹™æ¢æ¬¾ï¼");
  return;
}
fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: `ğŸ›ï¸ æ–°è¨‚å–®é€šçŸ¥\nğŸ‘¤ å§“åï¼š${name}\nğŸ“§ Emailï¼š${email}\n${orderDesc}`
      })
    }).then(res => {
      if (res.ok) {
        alert("è¨‚å–®å·²é€å‡ºï¼Œæ„Ÿè¬æ‚¨çš„è³¼è²·ï¼");
        // é‡ç½®æ•´å€‹é é¢
        cart = [];
        renderCart();
        checkoutSection.classList.add("hidden");
        step2Div.classList.add("hidden");
        step3Div.classList.add("hidden");
        step4Div.classList.add("hidden");
        addToCartBtn.disabled = true;
        categorySel.value = "";
        subcategorySel.innerHTML = "";
        tier3Sel.innerHTML = "";
        tier4Sel.innerHTML = "";
        paymentMethodSel.value = "";
        paymentInfoDiv.textContent = "";
      } else {
        alert("è¨‚å–®é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
      }
    }).catch(() => {
      alert("è¨‚å–®é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
    });
  });

  // ç›£è½é¸æ“‡è®ŠåŒ–æ›´æ–°ä¸‹ä¸€æ­¥
  categorySel.addEventListener("change", () => {
    updateSubcategories();
    addToCartBtn.disabled = true;
  });

  subcategorySel.addEventListener("change", () => {
    updateTier3();
    addToCartBtn.disabled = true;
  });

  tier3Sel.addEventListener("change", () => {
    updateTier4();
    addToCartBtn.disabled = true;
  });

  tier4Sel.addEventListener("change", () => {
    selectedTier4 = tier4Sel.value;
    updateAddToCartStatus();
  });

  customAmountInput.addEventListener("input", () => {
    const val = parseInt(customAmountInput.value);
    if (!isNaN(val) && val > 0) {
      customAmount = val;
      customPriceSpan.textContent = Math.round(val * 0.18);
    } else {
      customAmount = 0;
      customPriceSpan.textContent = "0";
    }
    updateAddToCartStatus();
  });

  addToCartBtn.addEventListener("click", addToCart);
  // åˆå§‹åŒ–ç•«é¢
  updateSubcategories();

})();
</script>
</body>
</html>
